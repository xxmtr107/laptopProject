<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Thêm Laptop</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
</head>
<body>
<div class="container mt-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Thêm Laptop mới</h2>
        <a href="/admin/dashboard" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Về Dashboard
        </a>
    </div>
    <form th:action="@{/admin/laptops/add}" th:object="${laptop}" method="post">
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="name" class="form-label">Tên laptop <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="name" th:field="*{name}" required/>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="price" class="form-label">Giá (VNĐ) <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="price" th:field="*{price}" required min="0" step="1000"/>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="brandId" class="form-label">Thương hiệu <span class="text-danger">*</span></label>
                    <select class="form-select" id="brandId" name="brandId" required>
                        <option value="">-- Chọn thương hiệu --</option>
                        <option th:each="brand : ${brands}" th:value="${brand.brandId}" th:text="${brand.brandName}"></option>
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="seriesId" class="form-label">Series <span class="text-danger">*</span></label>
                    <select class="form-select" id="seriesId" name="seriesId" required>
                        <option value="">-- Chọn series --</option>
                        <option th:each="series : ${seriesList}" 
                                th:value="${series.seriesId}" 
                                th:text="${series.seriesName}"
                                th:attr="data-brand-id=${series.brand != null ? series.brand.brandId : ''}"></option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="stock" class="form-label">Số lượng trong kho <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="stock" th:field="*{stock}" required min="0"/>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="featured" class="form-label">Sản phẩm nổi bật</label>
                    <select class="form-select" id="featured" th:field="*{featured}">
                        <option th:value="false">Không</option>
                        <option th:value="true">Có</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="image" class="form-label">URL hình ảnh</label>
            <input type="text" class="form-control" id="image" th:field="*{image}" placeholder="https://example.com/image.jpg"/>
            <small class="form-text text-muted">Nhập URL đầy đủ của hình ảnh</small>
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Mô tả</label>
            <textarea class="form-control" id="description" th:field="*{description}" rows="5" placeholder="Nhập mô tả chi tiết về sản phẩm..."></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Thêm Laptop</button>
        <a href="/admin/laptops" class="btn btn-secondary">Hủy</a>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Dynamic filtering of series based on selected brand
    const brandSelect = document.getElementById('brandId');
    const seriesSelect = document.getElementById('seriesId');
    const allSeries = [];

    // Store all series with their brand information
    document.addEventListener('DOMContentLoaded', function() {
        const seriesOptions = seriesSelect.querySelectorAll('option');
        seriesOptions.forEach(option => {
            if (option.value) {
                allSeries.push({
                    value: option.value,
                    text: option.text,
                    brandId: option.getAttribute('data-brand-id')
                });
            }
        });
    });

    // Filter series when brand changes
    brandSelect.addEventListener('change', function() {
        const selectedBrandId = this.value;
        
        // Clear current series options except the first one
        seriesSelect.innerHTML = '<option value="">-- Chọn series --</option>';
        
        if (selectedBrandId) {
            // Add only series that belong to the selected brand
            allSeries.forEach(series => {
                if (series.brandId === selectedBrandId) {
                    const option = document.createElement('option');
                    option.value = series.value;
                    option.text = series.text;
                    option.setAttribute('data-brand-id', series.brandId);
                    seriesSelect.appendChild(option);
                }
            });
        } else {
            // If no brand selected, show all series
            allSeries.forEach(series => {
                const option = document.createElement('option');
                option.value = series.value;
                option.text = series.text;
                option.setAttribute('data-brand-id', series.brandId);
                seriesSelect.appendChild(option);
            });
        }
    });
</script>
</body>
</html>
